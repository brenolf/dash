!function(a){"use strict";a.DashLevel=function(a,b,c){if(!a)return!1;for(var d=a.length,e=4,f=sec2ms(2),g=sec2ms(.04),h=sec2ms(.5),i=0,j=0;d>j;j++){var k=a[j];void 0!==k.morph?(void 0===k.missable&&(k.missable=!0),void 0===k.first_turn&&(k.first_turn=!0),void 0===k.rounds&&(k.rounds=0),void 0===k.constraints&&(k.constraints=[])):a[j]=null}for(var l=[],j=0;d>j;j++){var k=a[j];if(null!==k){var m={index:j,rounds:k.rounds};l.push(m)}}for(var n={},j=0;d>j;j++){var k=a[j],o=j;void 0!==k.alias&&(o=k.alias),n[o]=j}if(0===l.length)return!1;l.sort(function(a,b){return a.rounds-b.rounds}),void 0===c&&(c=1),void 0===b&&(b={}),void 0===b.press_time&&(b.press_time=f),void 0===b.step&&(b.step=g),void 0===b.minimun_velocity&&(b.minimun_velocity=h);var p=this;p.expected=null;var q={expected:null,missable:null,direction:null};p.challenges=null,p.direction=null,p.press_time=b.press_time,p.missable=!0;var r=-1,s=.5;p.allowed=[];var t=function(a){return~~(Math.random()*a)},u=function(){if(0!==l.length){var a=l[0];a.rounds===r&&(p.allowed.push(a.index),l.shift(),u())}},v=function(){for(var a=t(e),b={expected:[a],challenges:[],missable:!0,direction:a},d=0;c>d;d++)b=w(b);p.expected=b.expected,p.challenges=b.challenges,p.missable=b.missable,q={expected:p.expected,missable:p.missable,direction:b.direction},p.direction=b.direction},w=function(b){b.expected;for(var g,h,e=b.challenges.length,i=null;;)if(h=t(d),g=a[h],(0!==r||g.first_turn)&&p.allowed.has(h)){for(var j=0;e>j;j++){var k=b.challenges[j];!k.constraints.has(n[h])}if(i=g.morph(b,q),q.missable!==!1||i.missable!==!1)break}return b.challenges.push(h),void 0===i.missable&&(i.missable=!0),void 0===i.direction&&(i.direction=b.direction),{expected:i.expected,challenges:b.challenges,missable:i.missable,direction:i.direction}};p.new_round=function(){r++,u(),v(),p.press_time=p.apply_ratio(p.press_time,1,b.minimun_velocity)},p.get_rounds=function(){return r},p.tic=function(){i=(new Date).getTime()},p.toc=function(){var a=(new Date).getTime(),b=a-i;s=(p.press_time-b)/p.press_time},p.get_ratio=function(){return s},p.apply_ratio=function(a,c,d){return a-=b.step*s,a-=.5*b.step,a=Math.max(a,d),Math.round(a/c)}}}(window);