// Dash v 0.3  | (c) 2015 Breno Lima de Freitas - breno.io | Licensed under CC-NC-ND
!function(a){"use strict";a.DashLevel=function(a,b,c){if(!a)return!1;for(var d=a.length,e=4,f=sec2ms(2),g=sec2ms(.04),h=sec2ms(.7),i=0;d>i;i++){var j=a[i];void 0!==j.morph?(void 0===j.first_turn&&(j.first_turn=!0),void 0===j.rounds&&(j.rounds=0),void 0===j.constraints&&(j.constraints=[])):a[i]=null}for(var k=[],i=0;d>i;i++){var j=a[i];if(null!==j){var l={index:i,rounds:j.rounds};k.push(l)}}if(0===k.length)return!1;k.sort(function(a,b){return a.rounds-b.rounds}),void 0===c&&(c=1),void 0===b&&(b={}),void 0===b.press_time&&(b.press_time=f),void 0===b.step&&(b.step=g),void 0===b.minimun_velocity&&(b.minimun_velocity=h);var m=this;m.expected=null;var n={expected:null,missable:null};m.challenges=null,m.raw=null,m.press_time=b.press_time,m.missable=!0;var o=-1;m.allowed=[];var p=function(a){return~~(Math.random()*a)},q=function(){if(0!==k.length){var a=k[0];a.rounds===o&&(m.allowed.push(a.index),k.shift(),q())}},r=function(){var a=p(e),b={expected:[a],challenges:[],missable:!0};m.raw=a;for(var d=0;c>d;d++)b=s(b);m.expected=b.expected,m.challenges=b.challenges,m.missable=b.missable,n={expected:m.expected,missable:m.missable}},s=function(b){b.expected;for(var g,h,e=b.challenges.length;;)if(h=p(d),g=a[h],(0!==o||g.first_turn)&&m.allowed.has(h)){for(var i=0;e>i;i++){var j=b.challenges[i];!j.constraints.has(h)}break}b.challenges.push(h);var k=g.morph(b,n);return void 0===k.missable&&(k.missable=!0),{expected:k.expected,challenges:b.challenges,missable:k.missable}};m.new_round=function(){o++,q(),r(),m.press_time-=b.step,m.press_time=Math.max(m.press_time,b.minimun_velocity)},m.get_rounds=function(){return o}}}(window);