// Dash v 0.2  | (c) 2015 Breno Lima de Freitas - breno.io | Licensed under CC-NC-ND
var CONFIGURATIONS=5,DIRECTIONS=4,PRESS_TIME=sec2ms(2),STEP=sec2ms(.04),MINIMUM_VELOCITY=sec2ms(.7),constraints={0:[],1:[3,4],2:[3,4],3:[1,2,4],4:[1,2,3]};!function(a){"use strict";a.DashLevel=function(a,b,c){if(!a||0===a.length)return!1;void 0===c&&(c=1),void 0===b&&(b={}),void 0===b.press_time&&(b.press_time=PRESS_TIME),void 0===b.step&&(b.step=STEP);var d=this;d.expected=null;var e={expected:null,missable:null};d.challenges=null,d.raw=null,d.press_time=b.press_time,d.missable=!0;var f=-1;d.allowed=[];var g=function(a){return~~(Math.random()*a)},h=function(){if(0!==a.length){var b=a[0];b.rounds===f&&(d.allowed.push_array(b.challenges),a.shift())}},i=function(){var a=g(DIRECTIONS),b={expected:[a],challenges:[]};d.raw=a;for(var f=0;c>f;f++)b=j(b.expected,b.challenges);d.expected=b.expected,d.challenges=b.challenges,d.missable=b.missable,e={expected:d.expected,missable:d.missable}},j=function(a,b){for(var i,c=b.length,j={expected:[],challenges:b,missable:!0};;)if(i=g(CONFIGURATIONS),(0!==f||3!==i)&&d.allowed.has(i)){for(var k=0;c>k;k++)if(constraints[b[k]].has(i))continue;break}switch(j.challenges.push(i),i){case 0:j.expected.push(a[0]);break;case 1:for(var c=a.length,k=0;c>k;k++)j.expected.push(mod(a[k]+2,4));break;case 2:j.expected.push(a[0]),j.expected.push(a[0]);break;case 3:j.expected=e.expected,j.missable=e.missable;break;case 4:j.expected=[],j.missable=!1}return j};d.new_round=function(){f++,h(),i(),d.press_time-=b.step,d.press_time=Math.max(d.press_time,MINIMUM_VELOCITY)},d.get_rounds=function(){return f}}}(window);