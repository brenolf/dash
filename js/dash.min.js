function stack_key(a){if(void 0===a)return sequence=[],void 0;sequence.push(a);var b=sequence.length,c=Level.expected.length;return 0===c?sequence:(b>c&&sequence.shift(),b===c?sequence:c>b?null:void 0)}function adjust_key(a){var b={65:0,87:1,68:2,83:3};return a>=37&&40>=a?a-37:void 0!==b[a]?b[a]:-1}function wrong(){return Interface.toc(),Interface.fails(lives),clearTimeout(timer),0===--lives?game_over():(game(),void 0)}function correct(){Interface.toc(),Interface.scores(++right),right>BEST_SCORE&&!new_best&&(achievement(),new_best=!0),clearTimeout(timer),game()}function game_over(){right>BEST_SCORE&&(BEST_SCORE=right,$.cookie("best",right+"",{expires:365})),Interface.dismiss(),best.html(BEST_SCORE),clearTimeout(timer),playing=!1}function evaluate_pan(a){for(var b=["left","up","right","down"],c=0;4>c&&!(a.indexOf(b[c])>=0);c++);evaluate(c+37)}function evaluate(a){if(playing&&!paused&&allowed&&(a=adjust_key(a),-1!==a)){var b=stack_key(a);null!==b&&(b.compare(Level.expected)?correct():wrong())}}function game(){playing&&!paused&&(Level.new_round(),stack_key(),allowed=!1,Interface.retrieve(Level.raw,Level.challenges,function(){Interface.tic(Level.press_time),allowed=!0,clearTimeout(timer),timer=setTimeout(function(){return Level.missable?wrong():(sequence.compare(Level.expected)?correct():wrong(),void 0)},Level.press_time)}))}function prepare(){Level=new DashLevel([{rounds:0,challenges:[0]},{rounds:20,challenges:[2]},{rounds:30,challenges:[1]},{rounds:40,challenges:[4]},{rounds:60,challenges:[3]}]),Interface.prepare(),lives=3,right=0,playing=!0,new_best=!1}var best=null,Level=null,Interface=null,right=0,lives=3,DEFAULTS={PRESETS:8},BEST_SCORE=0,new_best=!1,timer=null,paused=!1,playing=!1,allowed=!1,sequence=[];$(document).ready(function(){Interface=new DashGUI({panels:["#panel-0","#panel-1"],icons:["#panel-0 i","#panel-1 i"],score:{main:"#score",timer:"#gauge",lives:".lives div",points:"#counter"}},{presets:DEFAULTS.PRESETS,panel:"preset-*",icon:"icon-angle-.",wrong_icon:"icon-cancel",life_lost:"+lost",correct_icon:"+correct",replace_array:["left","up","right","down"]},{1:{panel:"reverse-*"},2:{icon:"icon-angle-double-."},3:{icon:"icon-cw"},4:{icon:"+pressed"}}),window.addEventListener("focus",function(){paused=!1,game()}),window.addEventListener("blur",function(){paused=!0,clearTimeout(timer)}),$("body").keydown(function(a){evaluate(a.keyCode)}),Hammer(document.body,{recognizers:[[Hammer.Swipe,{direction:Hammer.DIRECTION_ALL}]]}).on("swipeleft",function(a){evaluate_pan(a.type)}).on("swipeup",function(a){evaluate_pan(a.type)}).on("swiperight",function(a){evaluate_pan(a.type)}).on("swipedown",function(a){evaluate_pan(a.type)}),best=$("#best"),void 0===$.cookie("best")&&$.cookie("best","0",{expires:365}),BEST_SCORE=$.cookie("best"),best.html(BEST_SCORE),$("#btn_play").click(function(){prepare(),game()})});