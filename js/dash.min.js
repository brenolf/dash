// Dash v 0.4  | (c) 2015 Breno Lima de Freitas - breno.io | Licensed under CC-NC-ND
!function(a){"use strict";a.Dash=function(a,b,c,d){function q(a){if(void 0===a)return p=[],void 0;p.push(a);var b=p.length,c=f.expected.length;return 0===c?p:(b>c&&p.shift(),b===c?p:c>b?null:void 0)}function r(a){var b={65:0,87:1,68:2,83:3};return a>=37&&40>=a?a-37:void 0!==b[a]?b[a]:-1}function s(){return b.lost_life(h-1),a.toc(),a.fails(h),clearTimeout(l),0===--h?u():(e.start(),void 0)}function t(){g++,b.got_point(g),a.toc(),a.scores(g),g>i&&!k&&(b.best_score(g),k=!0),g===j&&a.hide_timer(),clearTimeout(l),e.start()}function u(){a.dismiss(),clearTimeout(l),n=!1,b.after_game(g)}function v(a){for(var b=["left","up","right","down"],c=0;4>c&&!(a.indexOf(b[c])>=0);c++);w(c+37)}function w(a){if(n&&!m&&o&&(a=r(a),-1!==a)){var c=q(a);b.key_pressed(a,f.expected,f.challenges),null!==c&&(c.compare(f.expected)?t():s())}}if(!a)return!1;var e=this,f=null,g=0,h=3,i=0,j=-1,k=!1,l=null,m=!1,n=!1,o=!1,p=[];e.start=function(){n&&!m&&(b.before_game(),f.new_round(),q(),o=!1,a.retrieve(f.raw,f.challenges,function(){a.tic(f.press_time),o=!0,clearTimeout(l),l=setTimeout(function(){return f.missable?s():(p.compare(f.expected)?t():s(),void 0)},f.press_time)}))},e.prepare=function(b,e,l,m){void 0===e&&(e=3),void 0===l&&(l=0),void 0===m&&(m=-1),i=l,j=m,f=new DashLevel(b,c,d),a.prepare(),h=e,g=0,n=!0,k=!1},e.init=function(){var c=["before_game","after_game","best_score","lost_life","got_point","key_pressed"],d=c.length;void 0===b&&(b={});for(var f=0;d>f;f++){var g=c[f];void 0===b[g]&&(b[g]=function(){})}window.addEventListener("focus",function(){m=!1,e.start()}),window.addEventListener("blur",function(){m=!0,clearTimeout(l)}),$("body").keydown(function(a){var b=a.keyCode;b>=37&&40>=b&&(a.preventDefault(),a.stopPropagation()),w(b)});var h=a.getPanels();d=h.length;for(var f=0;d>f;f++)Hammer(h[f].get(0),{recognizers:[[Hammer.Swipe,{direction:Hammer.DIRECTION_ALL,velocity:.2,threshold:10}]]}).on("swipeleft",function(a){v(a.type)}).on("swipeup",function(a){v(a.type)}).on("swiperight",function(a){v(a.type)}).on("swipedown",function(a){v(a.type)});return e}}}(window);