// Dash v 0.3  | (c) 2015 Breno Lima de Freitas - breno.io | Licensed under CC-NC-ND
!function(a){"use strict";a.Dash=function(a,b){function n(a){if(void 0===a)return m=[],void 0;m.push(a);var b=m.length,c=d.expected.length;return 0===c?m:(b>c&&m.shift(),b===c?m:c>b?null:void 0)}function o(a){var b={65:0,87:1,68:2,83:3};return a>=37&&40>=a?a-37:void 0!==b[a]?b[a]:-1}function p(){return b.lost_life(f-1),a.toc(),a.fails(f),clearTimeout(i),0===--f?r():(c.start(),void 0)}function q(){e++,b.got_point(e),a.toc(),a.scores(e),e>g&&!h&&(b.best_score(e),h=!0),clearTimeout(i),c.start()}function r(){a.dismiss(),clearTimeout(i),k=!1,b.after_game(e)}function s(a){for(var b=["left","up","right","down"],c=0;4>c&&!(a.indexOf(b[c])>=0);c++);t(c+37)}function t(a){if(k&&!j&&l&&(a=o(a),-1!==a)){var c=n(a);b.key_pressed(a,d.expected,d.challenges),null!==c&&(c.compare(d.expected)?q():p())}}if(!a)return!1;var c=this,d=null,e=0,f=3,g=0,h=!1,i=null,j=!1,k=!1,l=!1,m=[];c.start=function(){k&&!j&&(b.before_game(),d.new_round(),n(),l=!1,a.retrieve(d.raw,d.challenges,function(){a.tic(d.press_time),l=!0,clearTimeout(i),i=setTimeout(function(){return d.missable?p():(m.compare(d.expected)?q():p(),void 0)},d.press_time)}))},c.prepare=function(b,c,i){void 0===b&&(b=3),void 0===c&&(c=0),g=c,d=new DashLevel(i),a.prepare(),f=b,e=0,k=!0,h=!1},c.init=function(){var a=["before_game","after_game","best_score","lost_life","got_point","key_pressed"],d=a.length;void 0===b&&(b={});for(var e=0;d>e;e++){var f=a[e];void 0===b[f]&&(b[f]=function(){})}return window.addEventListener("focus",function(){j=!1,c.start()}),window.addEventListener("blur",function(){j=!0,clearTimeout(i)}),$("body").keydown(function(a){t(a.keyCode)}),Hammer(document.body,{recognizers:[[Hammer.Swipe,{direction:Hammer.DIRECTION_ALL,velocity:.2,threshold:10}]]}).on("swipeleft",function(a){s(a.type)}).on("swipeup",function(a){s(a.type)}).on("swiperight",function(a){s(a.type)}).on("swipedown",function(a){s(a.type)}),c}}}(window);