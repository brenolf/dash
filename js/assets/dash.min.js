var DIRECTIONS=4;!function(e){"use strict";e.DashGUI=function(e,s,n){var r=this;r.DROP_TIME=700,r.MIN_DROP_TIME=300;var a=r.DROP_TIME,i=[],t=1,o=e.panels.length;r.direction=null;var c=0,l=-1;void 0!==s.base_index&&(c=s.base_index);for(var d,p=0;p<e.panels.length;p++)e.panels[p]=$(e.panels[p]);for(var p=0;p<e.icons.length;p++)e.icons[p]=$(e.icons[p]);for(var p in e.score)e.score[p]=$(e.score[p]);var f=function(){var e;do e=~~(Math.random()*s.presets);while(i.has(e));return i.push(e),i.length>=s.presets/2&&i.shift(),e};r.getPanels=function(){return e.panels};var v=function(e,n){var r={addClass:!1,class_name:e};return"+"===e.charAt(0)&&(r.addClass=!0,e=e.substr(1)),void 0!==n&&(e=e.replace(/\*/g,n),void 0!==s.replace_array[n]&&(e=e.replace(/\./g,s.replace_array[n]))),r.class_name=e,r},m=function(e,s,n){s?e.addClass(n):e.removeClass().addClass(n)},u=function(e,s,n){var r=v(s,n);m(e,r.addClass,r.class_name)};r.retrieve=function(i,p,v){r.direction=i;var m=f(),h=p.length,_=e.panels,x=mod(t+1,o);_[x].css("z-index",c),_[t].css("z-index",c+1);var g=e.icons[x];u(_[x],s.panel,m),u(g,s.icon,i);for(var w=0;h>w;w++)if(p[w]in n){var I=n[p[w]];I.panel&&u(_[x],I.panel,m),I.icon&&u(g,I.icon,i)}if(u(e.score.timer,s.timer_color,m),-1===l){var y=~~(Math.random()*DIRECTIONS),C=d[y];_[x].css({left:C.x,top:C.y}),_[x].animate({left:0,top:0},a,v)}else{var C=d[l];_[x].css({left:0,top:0}),_[t].animate({left:C.x,top:C.y},a,v)}l=i,t=x},r.prepare=function(){var n=$(window).width()+10,r=$(window).height()+10;d=[{x:"-"+n+"px",y:"0"},{x:"0",y:"-"+r+"px"},{x:n+"px",y:"0"},{x:"0",y:r+"px"}],l=-1,e.score.main.css("z-index",2*(c+1)),e.score.timer.css("z-index",2*(c+1)),e.score.timer.parent().fadeIn(),e.score.points.html(0),e.score.main.fadeIn();for(var a=0;a<e.panels.length;a++)e.panels[a].css({top:"-100%",left:"-100%",display:"block"});e.score.timer.css("width",0);var i=v(s.life_lost);e.score.lives.removeClass(i.class_name)},r.dismiss=function(){for(var s=0;s<e.panels.length;s++)e.panels[s].fadeOut();e.score.main.fadeOut(),e.score.timer.parent().fadeOut()},r.fails=function(n){n--,u(e.icons[t],s.wrong_icon,r.direction),void 0!==e.score.lives.eq(n)&&u(e.score.lives.eq(n),s.life_lost)},r.scores=function(n){e.score.points.html(n),u(e.icons[t],s.correct_icon,r.direction)},r.tic=function(s){"block"===e.score.timer.parent().css("display")&&e.score.timer.animate({width:"100%"},s)},r.toc=function(){e.score.timer.stop().css("width",0)},r.hide_timer=function(){r.toc(),e.score.timer.parent().fadeOut()},r.get_drop_time=function(){return a},r.set_drop_time=function(e){a=e}}}(window);
!function(e){"use strict";e.DashLevel=function(e,i,n){if(!e)return!1;for(var s=e.length,t=4,r=sec2ms(2),o=sec2ms(.04),l=sec2ms(.5),a=0,c=0;s>c;c++){var d=e[c];void 0!==d.morph?(void 0===d.missable&&(d.missable=!0),void 0===d.first_turn&&(d.first_turn=!0),void 0===d.rounds&&(d.rounds=0),void 0===d.constraints&&(d.constraints=[])):e[c]=null}for(var u=[],c=0;s>c;c++){var d=e[c];if(null!==d){var m={index:c,rounds:d.rounds};u.push(m)}}for(var v={},c=0;s>c;c++){var d=e[c],p=c;void 0!==d.alias&&(p=d.alias),v[p]=c}if(0===u.length)return!1;u.sort(function(e,i){return e.rounds-i.rounds}),void 0===n&&(n=1),void 0===i&&(i={}),void 0===i.press_time&&(i.press_time=r),void 0===i.step&&(i.step=o),void 0===i.minimun_velocity&&(i.minimun_velocity=l);var f=this;f.expected=null;var h={expected:null,missable:null,direction:null};f.challenges=null,f.direction=null,f.press_time=i.press_time,f.missable=!0;var _=-1,g=.5;f.allowed=[];var b=function(e){return~~(Math.random()*e)},x=function(){if(0!==u.length){var e=u[0];e.rounds===_&&(f.allowed.push(e.index),u.shift(),x())}},w=function(){for(var e=b(t),i={expected:[e],challenges:[],missable:!0,direction:e},s=0;n>s;s++)i=y(i);f.expected=i.expected,f.challenges=i.challenges,f.missable=i.missable,h={expected:f.expected,missable:f.missable,direction:i.direction},f.direction=i.direction},y=function(i){for(var n,t,r=(i.expected,i.challenges.length),o=null;;)if(t=b(s),n=e[t],(0!==_||n.first_turn)&&f.allowed.has(t)){for(var l=0;r>l;l++){var a=i.challenges[l];!a.constraints.has(v[t])}if(o=n.morph(i,h),h.missable!==!1||o.missable!==!1)break}return i.challenges.push(t),void 0===o.missable&&(o.missable=!0),void 0===o.direction&&(o.direction=i.direction),{expected:o.expected,challenges:i.challenges,missable:o.missable,direction:o.direction}};f.new_round=function(){_++,x(),w(),f.press_time=f.apply_ratio(f.press_time,1,i.minimun_velocity)},f.get_rounds=function(){return _},f.tic=function(){a=(new Date).getTime()},f.toc=function(){var e=(new Date).getTime(),i=e-a;g=(f.press_time-i)/f.press_time},f.get_ratio=function(){return g},f.apply_ratio=function(e,n,s){return e-=i.step*g,e-=.5*i.step,e=Math.max(e,s),Math.round(e/n)}}}(window);
function sec2ms(r){return 1e3*r}function mod(r,t){return(r%t+t)%t}Array.prototype.has=function(r){for(var t=this.length,n=0;t>n;n++)if(this[n]===r)return!0;return!1},Array.prototype.push_array=function(r){for(var t=r.length,n=0;t>n;n++)this.push(r[n]);return this},Array.prototype.compare=function(r){var t=this.length;if(t!==r.length)return!1;for(var n=0;t>n;n++)if(this[n]!==r[n])return!1;return!0},Array.prototype.clone=function(){for(var r=this.length,t=[],n=0;r>n;n++)t.push(this[n]);return t};
!function(e){"use strict";e.Dash=function(e,t,n,o){function r(e){if(void 0===e)return y=[],null;y.push(e);var t=y.length,n=l.expected.length;return 0===n?y:t>n?(y.shift(),y):t===n?y:n>t?null:void 0}function i(e){var t={65:0,87:1,68:2,83:3};return e>=37&&40>=e?e-37:void 0!==t[e]?t[e]:-1}function c(){e.dismiss(),e.toc(),clearTimeout(_),h=!1,t.after_game(f)}function u(e){for(var t=["left","up","right","down"],n=0;4>n&&!(e.indexOf(t[n])>=0);n++);s(n+37)}function s(e){return h?(t.key_pressed(e,l.expected.clone(),l.challenges.clone()),g||!w?!1:void(a.test(e)===!0?a.correct():a.test(e)===!1&&a.wrong())):void 0}if(!e)return!1;var a=this,l=null,f=0,d=3,p=0,v=-1,m=!1,_=null,g=!1,h=!1,w=!1,y=[];a.wrong=function(){return l.toc(),t.lost_life(d-1),e.toc(),e.fails(d),clearTimeout(_),0===--d?c():void a.start()},a.correct=function(){l.toc(),f++,t.got_point(f),e.toc(),e.scores(f),f>p&&!m&&(t.best_score(f),m=!0),f===v&&e.hide_timer(),clearTimeout(_),a.start()},a.end=function(){c()},a.is_paused=function(){return g},a.test=function(e){if(e=i(e),-1===e)return null;var t=r(e);return null===t?null:!!t.compare(l.expected)},a.pause=function(){g=!0,clearTimeout(_),e.toc()},a.resume=function(){g=!1},a.start=function(){if(h&&!g){l.new_round(),r(),w=!1,t.before_game(l.direction,l.challenges);var n=e.get_drop_time();n=l.apply_ratio(n,.9999,e.MIN_DROP_TIME),n+=2+4*(1-l.get_ratio()),e.set_drop_time(Math.round(n)),e.retrieve(l.direction,l.challenges,function(){e.tic(l.press_time),w=!0,l.tic(),clearTimeout(_),_=setTimeout(function(){return l.toc(),l.missable?a.wrong():void(y.compare(l.expected)?a.correct():a.wrong())},l.press_time),setTimeout(function(){t.on_panel_retrieve(l.direction,l.challenges.clone(),l.expected.clone())},5)})}},a.prepare=function(t,r,i,c){void 0===r&&(r=3),void 0===i&&(i=0),void 0===c&&(c=-1),p=i,v=c,l=new DashLevel(t,n,o),e.prepare(),d=r,f=0,h=!0,m=!1},a.init=function(){var n=["before_game","after_game","best_score","lost_life","got_point","key_pressed"],o=n.length;void 0===t&&(t={});for(var r=0;o>r;r++){var i=n[r];void 0===t[i]&&(t[i]=function(){})}window.addEventListener("focus",function(){a.resume(),a.start();var e=$("title").html();$("title").html(e.replace(" - Paused",""))}),window.addEventListener("blur",function(){a.pause();var e=$("title").html();$("title").html(e+" - Paused")}),$("body").keydown(function(e){var t=e.keyCode;t>=37&&40>=t&&(e.preventDefault(),e.stopPropagation()),s(t)});var c=e.getPanels();o=c.length;for(var r=0;o>r;r++)Hammer(c[r].get(0),{recognizers:[[Hammer.Swipe,{direction:Hammer.DIRECTION_ALL,velocity:.2,threshold:10}]]}).on("swipeleft",function(e){u(e.type)}).on("swipeup",function(e){u(e.type)}).on("swiperight",function(e){u(e.type)}).on("swipedown",function(e){u(e.type)});return a},a.is_playing=function(){return h}}}(window);